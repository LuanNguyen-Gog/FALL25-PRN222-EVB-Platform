services:
  - type: web
    name: evb-api
    env: docker
    rootDir: .                     # build context = repo root (QUAN TRỌNG)
    dockerfilePath: EVB_Project.API/Dockerfile
    plan: starter   # or 'free' while testing
    autoDeploy: true
    # Health check (optional but recommended)
    healthCheckPath: /health
    envVars:
      # Bind Kestrel to Render's dynamic PORT
      - key: ASPNETCORE_URLS
        value: http://+:${PORT}
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      # Attach DB and inject its connection string to the app
      - key: ConnectionStrings__DefaultConnection
        fromDatabase:
          name: evb_postgres
          property: connectionString
      # If you require SSL (recommended on Render Postgres):
      - key: NPGSQL_SslMode
        value: Require
      - key: NPGSQL_TrustServerCertificate
        value: true
      # Other environment variables
      - key: JWT__Key
        sync: false
      - key: Jwt__Issuer
        value: EVB-API
      - key: Jwt__Audience
        value: EVB-CLIENT
      # Bật auto-migrate khi khởi động (Program.cs đã đọc key này)
      - key: ApplyMigrations
        value: true